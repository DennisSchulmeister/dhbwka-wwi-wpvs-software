<!-- ================ -->
<!-- Alte Vorlesungen -->
<!-- ================ -->
<section data-chapter data-title="Alte Vorlesungen"></section>

<!-- ––––––––––––––––––––––––––––––– -->
<!-- Womit haben wir es hier zu tun? -->
<!-- ––––––––––––––––––––––––––––––– -->
<section data-title="Womit haben wir es hier zu tun?">
    <p>
        Dieses Kapitel sammelt verschiedene Installationsaleitungen, die in
        früheren Versionen der Vorlesungen mal benötigt wurden. Sie werden
        daher nur benötigt, wenn Materialien dieser älteren Vorlesungsversionen
        von anderen Dozeten weiterverwendet werden sollen.
    </p>
    <ul>
        <li>
            Git und GitHub
        </li>
        <li>
            SoapUI
        </li>
        <li>
            Apache TomEE
        </li>
        <li>
            Apache Derby
        </li>

    </ul>
    <p>
        Die Programme haben dabei folgende Funktion:
    </p>

    <h3>Git</h3>
    <p>
        Einst waren Compiler und Editor alles, was man zum Programmieren benötigte.
        Doch je größer ein Projekt wird, desto schwieriger wird es, die Änderungen
        am Quellcode nachvollziehbar zu dokumentieren, so dass schon früh spezielle
        Werkzeuge hierfür entstanden sind. Git ist ein solches Werkzeug. es ermöglicht
        uns darüber hinaus aber auch, mit mehreren Personen am selben Quellcode zu
        arbeiten und diesen über das Internet zu teilen.
    </p>

    <h3>SoapUI</h3>
    <p>
        Im Rahmen der Vorlesung werden wir auch SOAP- und REST-Webservices programmieren,
        die häufig zur Kommunikation in verteilten Anwendungen genutzt werden. Dabei werden
        wir natürlich nicht umhin kommen, diese Services auch zu testen, was mit SoapUI
        besonders einfach von der Hand geht.
    </p>

    <h3>Apache TomEE</h3>
    <p>
        Serverseitig nutzen die meisten Java-Anwendungen einen so genannten Applikationsserver
        als Laufzeitumgebung. Denn als Bestandteil der Jakarta Enterprise Edition bietet er
        die gesamte technische Infrastruktur, die wir zur Entwicklung benötigen, so dass wir
        uns nur um die fachliche Anwendungslogik kümmern müssen. In der Vorlesung nutzen wir
        den TomEE von Apache, da dieser mit weniger Ressourcen auskommt und erfahrungsgemäß
        auch stabiler läuft, als andere Server.
    </p>

    <h3>Apache Derby</h3>
    <p>
        Kaum eine verteilte Anwendung kommt ohne eine Datenbank zur Speicherung und Verwaltung
        ihrer Daten aus, wobei hier meistens klassische SQL-Datenbanken zum Einsatz kommen.
        Kein Wunder also, dass Jakarta auch hier entsprechende Klassen definiert. Die meisten
        Datenbanken sind dabei mit Java kompatibel, wir nutzen aber Apache Derby, da sie
        nur wenig Speicher belegt und ohne großartige Installation auskommt.
    </p>
</section>

<!-- –––––––––––––––––––– -->
<!-- Installation von git -->
<!-- –––––––––––––––––––– -->
<section id="sec-git" data-title="Installation von Git">
    <p>
        <span class="nr">1)</span>
        Besuche die Webseite <a href="https://git-scm.com/" target="_blank">https://git-scm.com/</a>
        und lade das Installationspaket für dein Betriebssystem herunter.
    </p>
    <figure>
        <img src="img/git/download.png" />
        <figcaption>
            Download von Git
        </figcaption>
    </figure>

    <p>
        <span class="nr">2)</span>
        Unter Windows heißt die Installationsdatei <span class="fn">Git-2.18.0-64-bit.exe</span>
        oder ähnlich, wobei <span class="fn">2.18.0</span> die Versionsnummer ist und daher bei dir
        abweichen kann. Starte die Datei, um die Installation zu beginnen. Während der Installation
        wirst du gefragt, welche Komponenten installiert werden sollen. Du kannst die Vorauswahl
        einfach übernehmen und auf weiter klicken.
    </p>
    <figure>
        <img src="img/git/installation_1.png" />
        <figcaption>
            Auswahl der zu installierenden Komponenten
        </figcaption>
    </figure>
    <p>
        Im nächsten Schritt fragt das Setup, mit welchem Editor du deine Commit-Nachrichten erfassen willst.
        Falls hier <span class="scr">Notepad++</span> zur Auswahl steht, solltest du es auswählen. Im Grunde
        genommen ist es aber egal, da wir in der Vorlesung selten mit der Kommandozeile arbeiten werden.
    </p>
    <figure>
        <img src="img/git/installation_2.png" />
        <figcaption>
            Auswahl des bevorzugten Editors zur Erfassung der Commit-Nachrichten
        </figcaption>
    </figure>
    <p>
        Da Git ursprünglich für die Entwicklung des Linux-Kernels entwickelt wurde, enthält die Installation
        unter Windows eine Vielzahl von Kommandozeilenprogrammen aus der Unix-Welt. Linux- und mac-User haben
        diese Programme bereits installiert, unter Windows fehlen sie jedoch in der Regel. Die Auswahl im
        nächsten Schritt solltest daher auf <span class="scr">Use Git from the Windows Command Prompt</span>
        stehen lassen.
    </p>
    <figure>
        <img src="img/git/installation_3.png" />
        <figcaption>
            Auswahl der zu verwendenden Shell
        </figcaption>
    </figure>
    <p>
        Die nachfolgenden Fragen kannst du ebenfalls alle überspringen. Übernimm einfach die Voreinstellungen
        und klicke dich solange durch, bis die Installation beginnt.
    </p>
    <figure>
        <img src="img/git/installation_4.png" />
        <figcaption>
            Ab jetzt heißt es Warten …
        </figcaption>
    </figure>

    <p>
        <span class="nr">3)</span>
        Um die Installation zu testen, öffne ein Konsolenfenster. Am einfachsten geht dies über das Startmenü,
        indem du dort den Befehl <span class="cmd">cmd</span> eintippst und ausführst.
    </p>
    <figure>
        <img src="img/git/test_1.png" style="max-width: 25em;" />
        <figcaption>
            Start der Kommandozeile unter Windows
        </figcaption>
    </figure>
    <p>
        Gib innerhalb des Konsolenfensters den Befehl <span class="cmd">git</span> ein und bestätige ihn mit
        <kbd>ENTER</kbd>. Wenn alles gut geht, solltest du dann den Hilfetext von Git angezeigt bekommen.
    </p>
    <figure>
        <img src="img/git/test_2.png" />
        <figcaption>
            Anzeige des git-Hilfetexts innerhalb der Kommandozeile
        </figcaption>
    </figure>

    <p>
        <span class="nr">4)</span>
        An dieser Stelle solltest du dann gleich noch deinen Namen und deine E-Mailadresse in der Git-Konfiguration
        hinterlegen. Somit kann Git die von dir vorgenommenen Änderungen an einem Quellcode auch wirklich dir zuordnen.
        Gib daher folgende Befehle ein, wobei du <span class="scr">Max Mustermann</span> natürlich ersetzen musst:
    </p>
    <p class="cmd">
        git config --global user.email "max@mustermann.de" <br />
        git config --global user.name "Max Mustermann"
    </p>
    <p>
        <b>Hinweis für mac-User:</b> Sollte an dieser Stelle die Fehlermeldung <span class="scr">Invalid active
        developer path</span> erscheinen, musst du die
        <a href="http://osxdaily.com/2014/02/12/install-command-line-tools-mac-os-x/" target="_blank">Kommandozeilenwerkzeuge von Xcode installieren</a>.
        Gib hierfür einfach folgenden Befehl ein und klicke die Installation durch:
    </p>
    <p class="cmd">
        xcode-select --install
    </p>
    <p>
        Danach kannst du die Befehle zur Einrichtung von Git erneut versuchen:
    </p>
    <p class="cmd">
        git config --global user.email "max@mustermann.de" <br />
        git config --global user.name "Max Mustermann"
    </p>

    <p>
        <span class="nr">5)</span>
        Zum Schluss generieren wir noch die SSH-Schlüssel, mit denen du dich ohne Kennworteingabe später bei GitHub
        authentifizieren kannst. Öffne hierfür das Startmenü und wähle folgenden Eintrag aus: <span class="scr">Git</span>
        → <span class="scr">Git Bash</span>. Dadurch öffnet sich ein Konsolenfenster mit einer UNIX-artigen Konsole.
        Dort musst du dann folgende Befehle eingeben, wobei du <span class="cmd">schulmeist</span> natürlich durch deinen
        eigenen Anmeldenamen ersetzen musst. Diesen siehst du in der ersten Zeile vor dem <span class="scr">@</span>-Zeichen:
    </p>
    <p class="cmd">
        mkdir "/c/Users/schulmeist/.ssh" <br />
        ssh-keygen
    </p>
    <p>
        Wenn <span class="cmd">ssh-keygen</span> nach dem Ablageort der neuen Schlüsseldatei fragt, gib dementsprechend
        <span class="fn">"/c/Users/dein-benutzername/.ssh/id_rsa"</span> ein. Die anderen Fragen kannst mit <kbd>ENTER</kbd>
        einfach bestätigen. Achte bei allen Eingaben aber auf die exakte Schreibweise!
    </p>
    <figure>
        <img src="img/git/ssh.png" />
        <figcaption>
            Generieren des SSH-Schlüsselpaars für die sichere Authentifizierung bei GitHub
        </figcaption>
    </figure>
    <p>
        Anschließend kannst du das Fenster mit <span class="cmd">exit</span> beenden.
    </p>
</section>

<!-- ––––––––––––––––––––––––––––––– -->
<!-- Einrichtung eines GitHub-Kontos -->
<!-- ––––––––––––––––––––––––––––––– -->
<section id="sec-github" data-title="Einrichtung eines GitHub-Kontos">
    <p>
        <span class="nr">1)</span>
        Besuche die Seite <a href="https://github.com" target="_blank">https://github.com</a> und eröffne ein neues Konto.
    </p>
    <figure>
        <img src="img/github/signup.png" />
        <figcaption>
            Eröffnung eines neuen GitHub-Accounts
        </figcaption>
    </figure>

    <p>
        <span class="nr">2)</span>
        Logge dich auf GitHub ein und klicke oben rechts auf deinen Avatar. Anschließend wähle den Menüeintrag
        <span class="scr">Settings</span> aus.
    </p>
    <figure>
        <img src="img/github/settings-menu.png" />
        <figcaption>
            Aufruf der Einstellungen in GitHub
        </figcaption>
    </figure>

    <p>
        <span class="nr">3)</span>
        In den Einstellungen kannst du verschiedene Informationen über dich hinterlegen. Eine kurze Biographie,
        ein Link auf deine Webseite sowie ein Foto wären nicht schlecht. Mindestens solltest du aber deinen
        SSH-Schlüssel hinterlegen, damit du beim Programmieren nicht ständig deine Zugangsdaten eintippen musst.
        Klicke daher links auf <span class="scr">SSH and GPG keys</span>.
    </p>

    <p>
        <span class="nr">4)</span>
        Klicke nun oben rechts auf <span class="scr">New SSH key</span>. In der darauf folgenden Seite kannst du
        dem Schlüssel einen Namen geben (typischerweise der Name des Computers, zu dem er gehört). In das Feld
        <span class="scr">Key</span> musst du den Inhalt der Datei <span class="fn">c:\Benutzer\dein-benutzer\.ssh\id_rsa.pub</span>
        einfügen. Unter Linux und macOS heißt die Datei <span class="fn">~/.ssh/id/id_rsa.pub</span>.
    </p>
    <figure>
        <img src="img/github/ssh-key.png" />
        <figcaption>
            Copy & Paste deines öffentlichen SSH-Schlüssels nach GitHub
        </figcaption>
    </figure>

    <p>
        Klicke anschließend auf <span class="scr">Add SSH key</span>, um den neuen Schlüssel zu speichern.
    </p>
</section>

<!-- ––––––––––––––––––––––– -->
<!-- Installation von SoapUI -->
<!-- ––––––––––––––––––––––– -->
<section data-title="Installation von SoapUI">
    <p>
        <span class="nr">1)</span>
        Besuche die Webseite <a href="https://www.soapui.org/" target="_blank">https://www.soapui.org/</a> und lade die
        Open-Source-Version von SoapUI herunter. Diese ist auf der Webseite leider etwas versteckt, da der Hersteller
        einem lieber die kostenpflichtige Pro-Version andrehen will …
    </p>
    <figure>
        <img src="img/soapui/download.png" />
        <figcaption>
            Download von SoapUI
        </figcaption>
    </figure>

    <p>
        <span class="nr">2)</span>
        Unter Windows heißt die Installationsdatei <span class="fn">SoapUI-x32-5.4.0.exe</span>,
        wobei <span class="fn">5.4.0</span> die Versionsnummer ist und daher bei dir abweichen
        kann. Starte die Datei, um die Installation zu beginnen.
    </p>
    <figure>
        <img src="img/soapui/installation_1.png" />
        <figcaption>
            Installation von SoapUI
        </figcaption>
    </figure>
    <p>
        Unter Linux handelt es sich stattdessen einfach um eine ZIP-Datei, die du in unser Softwareverzeichnis
        extrahieren kannst. Der Start der Anwendung erfolgt hier mit der Datei <span class="fn">bin/soapui.sh</span>.
    </p>
    <figure>
        <img src="img/soapui/linux.png" />
        <figcaption>
            Start von SoapUI unter Linux
        </figcaption>
    </figure>

    <p>
        <span class="nr">3)</span>
        Bei der Auswahl der zu installierenden Komponenten kannst du alles abwählen. Wir benötigen kein <span class="scr">HermesJMS</span>
        und auch keine <span class="scr">Tutorials</span> für SoapUI. Danach kannst du die Installation durchlaufen lassen.
    </p>
    <figure>
        <img src="img/soapui/installation_2.png" />
        <figcaption>
            Abwählen aller Zusatzkomponenten bei der Installation von SoapUI
        </figcaption>
    </figure>
    <p>
</section>

<!-- –––––––––––––––––––––––––––––––– -->
<!-- Installation von TomEE und Derby -->
<!-- –––––––––––––––––––––––––––––––– -->
<section id="sec-tomee" data-title="Installation von TomEE und Derby">
    <p>
        <span class="nr">1)</span>
        Auf Moodle haben wir eine vorkonfigurierte Version von Apache TomEE und Apache Derby zur Verfügung gestellt.
        Lade das ZIP-Archiv auf deinen Rechner runter.
    </p>
    <figure>
        <img src="img/tomee/download.png" />
        <figcaption>
            Download von TomEE und Derby
        </figcaption>
    </figure>

    <p>
        <span class="nr">2)</span>
        Das ZIP-Archiv heißt schlicht <span class="fn">TomEE und Derby.zip</span>. Entpacke es in das Softwareverzeichnis für
        unsere Vorlesung. Dabei sollten die drei Verzeichnisse <span class="fn">apache-tomee-plume-8.0.0-M1</span>,
        <span class="fn">db-derby-10.14.2.0-bin</span> und <span class="fn">Datenbankinhalt</span> entstehen.
        Die exakten Versionsnummern können natürlich abweichen.
    </p>
    <figure>
        <img src="img/tomee/entpacken_1.png" />
        <figcaption>
            Entpacken von TomEE und Derby
        </figcaption>
    </figure>
    <figure>
        <img src="img/tomee/entpacken_2.png" />
        <figcaption>
            So sollte das Ergebnis aussehen
        </figcaption>
    </figure>

    <p>
        <span class="nr">3)</span>
        Zunächst wollen wir die Datenbank einrichten. Wechsle daher in NetBeans auf den Reiter <span class="scr">Services</span> und
        öffne dort das per Rechtsklick Kontextmenü zum Eintrag <span class="scr">Databases</span> → <span class="scr">Java DB</span>.
        Innerhalb des Menüs gehe dann auf <span class="scr">Properties…</span>.
    </p>
    <figure>
        <img src="img/tomee/derby_config_1.png" />
        <figcaption>
            Öffnen der Derby-Konfiguration in NetBeans
        </figcaption>
    </figure>

    <p>
        <span class="nr">4)</span>
        Wähle folgende, eben entpackte Verzeichnisse in dem Fenster aus und bestätige diese mit <span class="scr">OK</span>.
    </p>
    <ul>
        <li>
            <span class="scr">Java DB Installation:</span> <span class="fn">db-derby-10.14.2.0-bin</span>
        </li>
        <li>
            <span class="scr">Database Location:</span> <span class="fn">Datenbankinhalt</span>
        </li>
    </ul>
    <figure>
        <img src="img/tomee/derby_config_2.png" />
        <figcaption>
            Konfiguration der Datenbankverzeichnisse in NetBeans
        </figcaption>
    </figure>

    <p>
        <span class="nr">5)</span>
        Durch die eben vorgenommene Konfiguration sollte ein neuer Eintrag namens <span class="scr">jdbc:derby://localhost:1527/sample</span>
        im Ordner <span class="scr">Databases</span> erscheinen. Klicke ihn mit der rechten Maustaste an und gehe dann auf <span class="scr">Connect…</span>,
        um die Datenbank zu starten. Daraufhin sollten innerhalb des Ordners weitere Einträge mit den Schemas und Tabellen der Datenbank auftauchen.
        <b>Diesen Schritt musst du nun immer ausführen, wenn du eine Datenbankanwendung mit NetBeans entwickeln willst.</b>
    </p>
    <figure>
        <img src="img/tomee/derby_config_3.png" />
        <figcaption>
            Alles in Ordnung, die Datenbank läuft
        </figcaption>
    </figure>

    <p>
        <span class="nr">6)</span>
        Weiter geht es mit dem Applikationsserver. Öffne hierfür weiterhin im Reiter <span class="scr">Services</span> das Kontextmenü zum
        Eintrag <span class="scr">Servers</span> und gehe dort auf <span class="scr">Add Server…</span>. Im darauf folgenden Fenster wähle
        den Eintrag <span class="scr">Apache Tomcat or TomEE</span> aus und klicke auf <span class="scr">Next</span>.
    </p>
    <figure>
        <img src="img/tomee/nb_server_1.png" />
        <figcaption>
            Hinzufügen eines Tomcat- oder TomEE-Servers zu NetBeans
        </figcaption>
    </figure>

    <p>
        <span class="nr">7)</span>
        Gib im nächsten Schritt nun folgende Werte ein und schließe das Fenster dann mit <span class="scr">Finish</span>.
        Benutzername und Passwort kannst du frei wählen. Der Einfachheit halber nehmen wir hier <span class="cmd">admin</span>
        und <span class="cmd">admin</span>, die bereits in der TomEE-Konfiguration hinterlegt sind.
    </p>
    <ul>
        <li>
            <span class="scr">Server Location:</span> <span class="fn">apache-tomee-plume-8.0.0-M1</span>
        </li>
        <li>
            <span class="scr">Username:</span> <span class="cmd">admin</span>
        </li>
        <li>
            <span class="scr">Password:</span> <span class="cmd">admin</span>
        </li>
    </ul>
    <figure>
        <img src="img/tomee/nb_server_2.png" />
        <figcaption>
            Installationspfad und Zugangsdaten des TomEE-Servers
        </figcaption>
    </figure>

    <p>
        <span class="nr">8)</span>
        Falls der neue Server nicht nach wenigen Sekunden im Ordner <span class="scr">Servers</span> zu sehen ist,
        wähle den Menüpunkt <span class="scr">Tools</span> → <span class="scr">Options</span> aus und setze dort
        den Radiobutton bei <span class="scr">No Proxy</span>. Anschließend musst du NetBeans neustarten.
    </p>
    <figure>
        <img src="img/tomee/no_proxy.png" />
        <figcaption>
            Falls der neue Server in NetBeans nicht sichtbar ist, muss ggf. der Netzwerkproxy deaktiviert werden
        </figcaption>
    </figure>
    <p>
        Anschließend müsste der Server angezeigt werden und sich über das Kontextmenü starten lassen.
    </p>
    <figure>
        <img src="img/tomee/start.png" />
        <figcaption>
            Wenn diese Meldung erscheint, wurde der TomEE-Server erfolgreich gestartet.
        </figcaption>
    </figure>
</section>

<!-- ––––––––––––––––––––––––––––––––––––– -->
<!-- Änderungen an der TomEE-Konfiguration -->
<!-- ––––––––––––––––––––––––––––––––––––– -->
<section data-title="Änderungen an der TomEE-Konfiguration">
    <p>
        In einer älteren Version von „Verteilte Systeme” wurde noch die Java Enterprise
        Edition auf Basis von GlassFish und später Apache TomEE behandelt. Die nachfolgende
        Übersicht zeigt die Anpassungen, die an der Basiskonfiguration von TomEE notwendig
        sind, um diesen in der Vorlesung nutzen zu können.
    </p>

    <h3>Hinzufügen des Derby JDBC-Treibers</h3>
    <p>
        Im <span class="fn">lib</span>-Verzeichnis wurde die Datei <span class="fn">derbyclient.jar</span>
        mit dem JDBC-Treiber für Derby hinzugefügt. Die Datei ist in der Derby-Distribution vorhanden.
    </p>
    <figure>
        <img src="img/referenz/derbyclient.png" />
        <figcaption>
            JDBC-Treiber der Derby-Datenbank im <span class="fn">lib</span>-Verzeichnis von TomEE
        </figcaption>
    </figure>

    <h3>Definition der Datenbankverbindung</h3>
    <p>
        In der Datei <span class="fn">conf/tomee.xml</span> wurden zwei JNDI-Ressourcen für die
        Datenbankverbindungen hinterlegt. Gemäß Empfehlung aus dem Internet, wurde dabei sowohl
        eine <span class="scr">managed</span> als auch eine <span class="scr">unmanaged</span>
        Verindung definiert. Diese Verbindungen werden von allen Beispiel-Anwendungen verwendet
        und sind identisch zu der Version in NetBeans.
    </p>
    <pre data-gobble>
        <code class="html" data-gobble>
            &lt;?xml version="1.0" encoding="UTF-8"?&gt;
            &lt;tomee&gt;
                &lt;Resource id="Default-Database-Managed" type="javax.sql.DataSource"&gt;
                  JdbcDriver = org.apache.derby.jdbc.ClientDriver
                  JdbcUrl    = jdbc:derby://localhost:1527/sample
                  UserName   = app
                  Password   = app
                  JtaManaged = true
                &lt;/Resource&gt;

                &lt;Resource id="Default-Database-Unmanaged" type="javax.sql.DataSource"&gt;
                  JdbcDriver = org.apache.derby.jdbc.ClientDriver
                  JdbcUrl    = jdbc:derby://localhost:1527/sample
                  UserName   = app
                  Password   = app
                  JtaManaged = false
                &lt;/Resource&gt;
            &lt;/tomee&gt;
        </code>
    </pre>

    <h3>Zulassen gesicherter HTTPS-Verbindungen</h3>
    <p>
        Einige Beispiele in „Verteilte Systeme” zeigen, wie in der <span class="fn">web.xml</span>
        eine gesicherte HTTPS-Verbindung erzwungen werden kann, damit sensible Daten nicht unverschlüsselt
        übertragen werden. Leider ist SSL in der Standardkonfiguration von TomEE aber nicht aktiviert und
        es wird auch nicht einmal ein selbst-signiertes Serverzertifikat mitgeliefert. Folgende Zeilen
        wurden deshalb in der <span class="fn">conf/server.xml</span> eingefügt. Der Kommentar beschreibt
        dabei auch gleich, wie das selbst-signierte Zertifikat erzeugt wurde.
    </p>
    <pre data-gobble>
        <code class="html" data-gobble>
            &lt;Server port="8005" shutdown="SHUTDOWN"&gt;
                …
                &lt;Service name="Catalina"&gt;
                    …
                    &lt;Connector
                        protocol   = "HTTP/1.1"
                        port       = "8443"
                        maxThreads = "150"
                        SSLEnabled = "true"
                    &gt;
                        &lt;UpgradeProtocol
                            className  = "org.apache.coyote.http2.Http2Protocol"
                            xpoweredBy = "true"
                            server     = "Apache TomEE"
                        /&gt;
                        &lt;SSLHostConfig&gt;
                            &lt;!-- Vgl. https://tomcat.apache.org/tomcat-9.0-doc/ssl-howto.html (sehr gute Doku!)           --&gt;
                            &lt;!-- Vgl. https://tomcat.apache.org/tomcat-9.0-doc/config/http.html#SSL_Support_-_Certificate --&gt;
                            &lt;!--                                                                                          --&gt;
                            &lt;!-- Kommando zum Erzeugen der Keystore-Datei:                                                --&gt;
                            &lt;!-- keytool -genkey -alias tomcat -keyalg RSA -keystore localhost-rsa.jks -validity 7300     --&gt;
                            &lt;!--         -ext SAN=DNS:localhost -ext KU=digitalSignature -ext EKU=serverAuth              --&gt;
                            &lt;!--                                                                                          --&gt;
                            &lt;!-- Mit folgenden Angaben:                                                                   --&gt;
                            &lt;!-- CN=localhost, OU=Studiengang Wirtschaftsinformatik, O=DHBW Karlsruhe, L=Karlsruhe,       --&gt;
                            &lt;!-- ST=Baden-Württemberg, C=DE                                                               --&gt;
                            &lt;!--                                                                                          --&gt;
                            &lt;!-- Zertifikat dann exportiert mit:                                                          --&gt;
                            &lt;!-- keytool -keystore localhost-rsa.jks -exportcert -alias tomcat -rfc -file localhost.crt   --&gt;
                            &lt;!--                                                                                          --&gt;
                            &lt;!-- Passwort dabei immer:                                                                    --&gt;
                            &lt;!-- password                                                                                 --&gt;
                            &lt;Certificate
                                certificateKeystoreFile     = "conf/localhost-rsa.jks"
                                certificateKeystorePassword = "password"
                                type                        = "RSA"
                                xpoweredBy                  = "true"
                                server                      = "Apache TomEE"
                            /&gt;
                        &lt;/SSLHostConfig&gt;
                    &lt;/Connector&gt;
                    …
                &lt;/Service&gt;
            &lt;/Server&gt;
        </code>
    </pre>

    <h3>Hinzufügen der Rolle „manager-gui” für Benutzer „admin”</h3>
    <p>
        Dies ist für die Vorlesung nicht so wichtig. Jedoch wurde in der Datei <span class="fn">conf/tomcat-users.xml</span>
        der bereits vordefinierte Benutzer „admin” der Rolle „manager-gui” hinzugefügt. Somit kann bei Bedarf die Weboberfläche
        zur Administration des Servers gestartet werden.
    </p>
    <pre data-gobble>
        <code class="html" data-gobble>
            &lt;tomcat-users&gt;
                …
                &lt;user password="admin" roles="manager-script,admin,manager-gui" username="admin"/&gt;
            &lt;/tomcat-users&gt;
        </code>
    </pre>

    <h3>Zulassen von AJAX-Verbindungen auf fremde Domains</h3>
    <p>
        Gemäß Same-Origin-Policy erlauben moderne Browser keine AJAX-Zugriffe auf fremde Domains mehr, wenn dies nicht vom
        ausliefernden Webserver der Seite explizit erlaubt wird. Damit aber weiterhin AJAX-Zugriffe in den Beispielen und
        Aufgaben von „Webprogrammierung” und „Verteilte Systeme” möglich sind, wurden in der Datei <span class="fn">conf/web.xml</span>
        folgende Zeilen hinzugefügt, die einen Zugriff auf sämtliche, fremde Domains pauschal erlauben.
    </p>
    <pre data-gobble>
        <code class="html" data-gobble>
            &lt;web-app&gt;
                &lt;filter&gt;
                    &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
                    &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
                    &lt;init-param&gt;
                        &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
                        &lt;param-value&gt;*&lt;/param-value&gt;
                    &lt;/init-param&gt;
                    &lt;init-param&gt;
                        &lt;param-name&gt;cors.allowed.methods&lt;/param-name&gt;
                        &lt;param-value&gt;GET,PUT,POST,PATCH,DELETE,HEAD,OPTIONS&lt;/param-value&gt;
                    &lt;/init-param&gt;
                    &lt;init-param&gt;
                        &lt;param-name&gt;cors.allowed.headers&lt;/param-name&gt;
                        &lt;param-value&gt;Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers&lt;/param-value&gt;
                    &lt;/init-param&gt;
                    &lt;init-param&gt;
                        &lt;param-name&gt;cors.exposed.headers&lt;/param-name&gt;
                        &lt;param-value&gt;Access-Control-Allow-Origin,Access-Control-Allow-Credentials&lt;/param-value&gt;
                    &lt;/init-param&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                    &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
                    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt;
                …
            &lt;/web-app&gt;
        </code>
    </pre>

    <h3>Erhöhung des Log-Levels für Realm-Fehler</h3>
    <p>
        In den Beispielen für „Verteilte Systeme” wird auch gezeigt, wie ein datenbankgestütztes Anmeldeverfahren
        in eigenen Webanwendungen realisiert werden kann. Dabei sind Fehler in der Programmierung aber leider nicht
        immer von schlichten Eingabefehlern bei der Anmeldung zu unterscheiden. Falls dies der Fall ist, können in
        der Datei <span class="fn">conf/logging.properties</span> folgende Zeilen einkommentiert werden, um den
        Log-Level zu erhöhen:
    </p>
    <pre data-gobble>
        <code data-gobble>
            # Log-Meldungen für Auth-Versuche in den Anwendungen
            # Vgl. http://dev-answers.blogspot.com/2010/03/enable-debugtrace-level-logging-for.html
            #org.apache.catalina.realm.level = ALL
            #org.apache.catalina.realm.useParentHandlers = true
            #org.apache.catalina.authenticator.level = ALL
            #org.apache.catalina.authenticator.useParentHandlers = true
        </code>
    </pre>

    <h3>Vermeidung von Namenskollisionen gleichnamiger EJBs</h3>
    <p>
        Die Standardkonfiguration von TomEE lässt es nicht zu, dass zwei Webanwendungen unterschiedliche Enterprise
        Java Beans mit gleichem Namen beinhalten. Dies steht im Kontrast zu den meisten anderen EJB-Containern wie
        GlassFish oder WildFly, die damit keine Probleme haben. Aus diesem Grund kann in TomEE normalerweise eine
        Anwendung nicht deployed werden, wenn es bereits eine andere Anwendung mit gleichnamigen EJBs gibt. Natürlich
        kommt aber genau dies in unseren Beispielen vor, da die Beispiele oft ja nur Variationen desselben Themas sind.
        Aus diesem Grund wurden in der Datei <span class="fn">conf/system.properties</span> folgende Zeile hinzugefügt,
        um das Verhalten von TomEE an die anderen Server anzugleichen. Dadurch wird der Name der umgebenden Anwendung
        Teil des globalen EJB-Namens.
    </p>
    <pre data-gobble>
        <code data-gobble>
        openejb.deploymentId.format = {ejbJarId}/{ejbName}
        </code>
    </pre>

    <h3>Entfernte Methodenaufrufe für EJBs aktivieren</h3>
    <p>
        Seit TomEE 1.7.4 besitzt TomEE Blacklists und Whitelists für die Serialisierung von Objekten. Diese sind
        aus Sicherheitsgründen so eingestellt, dass alle Klassen auf der Blacklist stehen und die Whitelist komplett
        leer ist, wodurch entfernte Aufrufe der Enterprise Java Beans effektiv verhindert werden. Dummerweise hat
        die Blacklist immer eine höhere Priorität als die Whitelist. Umgekehrt wäre besser gewesen, um die Konfiguration
        zu vereinfachen …
    </p>
    <p>
        In der Datei <span class="fn">conf/system.properties</span> mussten daher folgende zwei Werte geändert werden,
        um die Blacklist zu deaktivieren und den Remote-Aufruf freizuschalten.
    </p>
    <pre data-gobble>
        <code data-gobble>
            tomee.serialization.class.blacklist = -
            tomee.remote.support = true
        </code>
    </pre>
</section>
